(function(){var a,b,c,d,e,f,g,h=Object.prototype.hasOwnProperty,i=function(a,b){function d(){this.constructor=a}for(var c in b)h.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},j=function(a,b){return function(){return a.apply(b,arguments)}};f=function(){function a(){}return a}(),a=function(){function a(a,b){this._cache={lower:-1},this._getkey=j(function(a,b){var c,d,e;for(d=0,e=a.length;d<e;d++){c=a[d];if(c.name===b)return c.value}return null},this),this.load=j(function(a,b,c,d,e,f){var g,h,i,k,l,m;return m={},g=!1,l=this._getkey(e,"iDisplayStart"),k=this._getkey(e,"iDisplayLength"),i=l+k,m.query={},m.query.limit=k,m.query.offset=l,h=$.apptools.api.rpc.createRPCRequest({method:c,api:a,params:m,async:!0}),$.apptools.dev.verbose("Stonerhub:Datagrid","Grid RPC request: ",h),h.fulfill({success:j(function(a){var b,c,d,g,h,i,j,k,l,m,n,o;g=[],n=a.data;for(j=0,l=n.length;j<l;j++){b=n[j],i=[b.key.value],h={},o=a.datagrid.columns;for(k=0,m=o.length;k<m;k++)d=o[k],i.push(b[d]),h[d]=b[d];g.push(i),$.stonerhub.models[b.key.kind].register(b.key.value,h)}return $.apptools.dev.verbose("Stonerhub:Datagrid","Translated data map: ",g),a.datagrid.columns.splice(0,0,"key"),c={sEcho:this._getkey(e,"sEcho"),iTotalRecords:a.resultset.results_count,iTotalDisplayRecords:a.resultset.returned_count,aaData:g,sColumns:a.datagrid.columns.join(",")},console.log("Final result",c),f(c)},this),failure:j(function(a){return alert("Datagrid failure. See console."),$.apptools.dev.error("Stonerhub:Datagrid","Grid RPC error: ",a)},this)})},this)}return i(a,f),a}(),b=function(){function a(a){}return i(a,f),a}(),d=function(){function a(a){}return i(a,f),a}(),g=function(){function a(a){this.state={total_upload_files:0},this.filters=[{title:"Basic Files",extensions:"txt,rtf"},{title:"Image Files",extensions:"jpg,jpeg,gif,png,tiff,ico,svg"},{title:"Document Files",extensions:"doc,docx,dot,pdf,rtf,txt"},{title:"Spreadsheet Files",extensions:"xls,xlsx"},{title:"Presentation Files",extensions:"ppt,pptx"},{title:"Movie Files",extensions:"mpg,mov,avi,wmv"},{title:"Drawing Files",extensions:"ai,eps,ps,dxf,ttf,psd"},{title:"Sound Files",extensions:"mp3,m4a,wav,flag,ogg"},{title:"Web Files",extensions:"html,css,sass,js,coffee,appcache,manifest"},{title:"Source Files",extensions:"py,rb,c,cpp,php,java"},{title:"Archive Files",extensions:"zip"}],this.create_uploader=j(function(a,b,c,d,e,f,g){var h;return this.selector=a,this.runtimes=b,this.browse_button=c,this.drag_drop=d!=null?d:!0,this.drop_element=e!=null?e:none,this.swf=f!=null?f:"runtime.flash-0.2.swf",this.silverlight=g!=null?g:"runtime.silverlight-0.2.xap",this.swf="/assets/ext/static/plupload/"+this.swf,this.silverlight="/assets/ext/static/plupload/"+this.silverlight,h=j(function(){return $(this.selector).plupload({runtimes:this.runtimes,browse_button:this.browse_button,preinit:this._bind_uploader_events,url:"#",use_query_string:!1,multipart:!0,drop_element:this.drop_element,flash_swf_url:this.swf,silverlight_xap_url:this.silverlight,dragdrop:this.drag_drop,filters:this.filters})},this)},this),this._bind_uploader_events=j(function(a){return a.bind("UploadFile",this.events.upload_file),a.bind("FileUploaded",this.events.file_uploaded),a.bind("QueueChanged",this.events.queue_changed)},this),this.events={upload_file:j(function(a,b){var c,d;return c=this.get_mime(b.name),this.session_key!=null?d=$.apptools.api.upload.generate_upload_url({upload_count:a.total.queued,upload_session:this.session_key}):d=$.apptools.api.upload.generate_upload_url({upload_count:a.total.queued,new_session:!0}),d.fulfill({success:j(function(b){return a.settings.url=b.upload_url,a.settings.multipart_params={session_key:this.session_key,blob_content_type:c}},this),failure:j(function(a){return alert("There was an error generating an upload endpoing. See console."),$.apptools.dev.error("upload","Uploader error: ",a)},this)})},this),file_uploaded:j(function(a,b,c){return this.state.total_upload_files--,console.log("FILE UPLOAD RESPONSE",a,b,c)},this),queue_changed:j(function(a,b){return this.state.total_upload_files=a.files.length},this)}}return i(a,f),a}(),c=function(){function a(a){}return i(a,f),a}(),e=function(){function e(e){return this.config=e,this.datatables=new a(this),this.liveservices=new b(this),this.newsfeed=new c(this),this.social=new d(this),this.upload=new g(this),this.models={ContentItem:{objects:{},register:function(a,b){return this.objects[a]=b},get:function(a){return this.objects[a]}}},this}return e}(),window.stonerhub=new e,typeof $!="undefined"&&$!==null&&$.extend({stonerhub:window.stonerhub})}).call(this)